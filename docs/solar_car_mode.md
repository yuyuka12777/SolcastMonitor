# ソーラーカーモードについて

## 概要
ソーラーカーモードは、移動する車両上のソーラーパネル用に特化した予測モードです。このモードでは、パネルの姿勢が常に変化することを考慮した特別な計算を行います。

## パラメータ

### 初期傾斜角
ソーラーパネルの基本的な傾斜角度を指定します。これは車体の基本設計に依存します。

### 走行方位角
車両の進行方向を指定します。
- 0度：北向き
- 90度：東向き
- 180度：南向き
- 270度：西向き

## 使用上の注意
1. **値の変動**: 実際の発電量は走行中の道路の起伏、カーブなどによって変動します
2. **時間帯の影響**: 太陽の位置によって最適な走行方向は変化します
3. **計算の近似**: このモードでは一定の条件下での近似計算を行うため、実際の値とは誤差が生じる場合があります

## 計算方法の詳細

ソーラーカーモードでは以下の手順で発電量予測を計算しています：

1. **GHI (全天日射量) と DNI (直達日射量) の取得**
   - APIから基本となる日射量データを取得

2. **太陽の位置計算**
   - 指定された日時と位置情報から太陽の天頂角と方位角を算出
   - 太陽天頂角: 太陽が頭上からどれだけ傾いているか（0°=真上、90°=地平線）
   - 太陽方位角: 太陽がどの方角にあるか（0°=北、90°=東、180°=南、270°=西）

3. **パネルへの入射角計算**
   - 太陽の位置と走行方向、パネル傾斜角から太陽光の入射角を計算
   - 入射角 = cos(パネル傾斜角) × cos(太陽天頂角) + sin(パネル傾斜角) × sin(太陽天頂角) × cos(太陽方位角 - 走行方位角)

4. **実効GTI (全天傾斜日射量) の計算**
   - 直達成分: DNI × cos(入射角)（入射角が90°を超える場合は0）
   - 散乱成分: (GHI - DNI × cos(太陽天頂角)) × (1 + cos(パネル傾斜角)) / 2
   - 反射成分: GHI × 反射率 × (1 - cos(パネル傾斜角)) / 2
   - 合計GTI = 直達成分 + 散乱成分 + 反射成分

5. **ソーラーカー特有の補正**
   - 走行中の揺れによる角度変動を考慮した補正係数（約0.95）を適用
   - 日中の時間帯による最適走行方向の変化を考慮した調整

この計算モデルでは、静止した固定角度のパネルと比較して、ソーラーカーの移動による太陽光の相対的な入射角変化を考慮しています。

## 最適な設定
- レース中は、太陽の動きに合わせて走行方向を調整することで発電効率を最大化できます
- 太陽が低い朝夕は、太陽に向かう/背ける方向に走行するとパネル角度の影響が大きくなります
- 南中時（正午頃）は水平に近いパネル角度（0〜10度）が最適です
- 曇りの日は散乱光が主体となるため、パネルをなるべく水平に近づける（傾斜角を小さくする）と効率が上がります

## 計算の限界
- この計算モデルは理想的な条件下での近似値です
- 実際の道路状況、天候変化、車体の空力特性などは考慮されていません
- より正確な予測のためには、実際の走行データとの比較検証が推奨されます
- この計算方式が正しいかどうかはよくわかりません
  間違い等があればissueを投げていただくと助かります